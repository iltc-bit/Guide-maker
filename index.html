<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>星雲計畫 - 照護指南</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] },
          animation: { 
            'neon-pulse': 'neon-pulse 2s infinite ease-in-out',
            'in': 'fade-in 0.3s ease-out'
          },
          keyframes: { 
            'neon-pulse': { '0%, 100%': { opacity: '0.9', transform: 'scale(1)' }, '50%': { opacity: '1', transform: 'scale(1.03)' } } 
          }
        }
      }
    }
  </script>
  <style>
    .pressure-slider { -webkit-appearance: none; width: 100%; height: 10px; background: #e5e7eb; border-radius: 5px; outline: none; }
    .pressure-slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 24px; height: 24px; border-radius: 50%; background: #ec4899; cursor: pointer; border: 3px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    @media print { 
      body { background: white; } 
      .no-print { display: none !important; } 
      #result-card { border: none !important; box-shadow: none !important; }
    }
  </style>
  <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.0.0",
    "react-dom": "https://esm.sh/react-dom@19.0.0",
    "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.460.0",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
  <!-- Babel 必須在加載後轉譯 -->
  <script src="https://unpkg.com/@babel/standalone@7.26.2/babel.min.js"></script>
</head>
<body class="bg-[#fffafb]">
  <div id="root"></div>
  
  <script type="text/babel" data-type="module" data-presets="typescript,react">
    import React, { useState, useMemo } from 'react';
    import ReactDOM from 'react-dom/client';
    import { 
      Heart, Users, Calendar, ShieldCheck, BookOpen, Activity, ArrowRight, 
      MessageSquare, Lock, Star, ChevronRight, RefreshCcw, Download
    } from 'lucide-react';

    const brandColors = {
      primary: '#ecacbc', secondary: '#a7d4e0', success: '#9bcba6',
      softPink: '#f4d0da', deepPink: '#d98a9d'
    };

    const questions = [
      { id: 1, text: '我能覺察自己的情緒極限，並在體力或精神透支前主動尋求喘息。', icon: <Heart size={20} /> },
      { id: 2, text: '我能讓周邊的人準確理解我的處境，避免因照顧問題產生衝突或孤立。', icon: <Users size={20} /> },
      { id: 3, text: '我能有效整合政府或民間各項資源，建立穩定的日常支援系統。', icon: <Calendar size={20} /> },
      { id: 4, text: '我對日常照顧流程有明確規劃，即使發生突發狀況也知道如何處理。', icon: <ShieldCheck size={20} /> },
      { id: 5, text: '我掌握被照顧者疾病的關鍵知識，能準確判斷其生理或行為變化的情況。', icon: <BookOpen size={20} /> },
      { id: 6, text: '在面臨醫療選擇或治療方案時，我能清楚衡量利弊並做出合適的決定。', icon: <Activity size={20} /> }
    ];

    const Avatar = ({ type, selected }) => {
      const colors = { female: '#FFEDF2', neutral: '#E0F2FE', male: '#ECFDF5' };
      const border = { female: '#F472B6', neutral: '#38BDF8', male: '#10B981' };
      return (
        <div className={`w-16 h-16 rounded-full flex items-center justify-center transition-all ${selected ? 'ring-4' : 'opacity-40 grayscale'}`} 
             style={{ backgroundColor: colors[type] || '#eee', ringColor: border[type] }}>
          {type === 'female' ? <Heart size={28} color="#F472B6" /> : type === 'male' ? <Activity size={28} color="#10B981" /> : <Users size={28} color="#38BDF8" />}
        </div>
      );
    };

    const App = () => {
      const [currentPage, setCurrentPage] = useState('intro');
      const [scores, setScores] = useState({});
      const [nebulaData, setNebulaData] = useState({ q1: 5, q8: '', nickname: '', avatar: 'female' });
      const [showConsult, setShowConsult] = useState(false);

      const isAssessmentComplete = useMemo(() => Object.keys(scores).length === questions.length, [scores]);

      const handleRestart = () => {
        setScores({});
        setCurrentPage('intro');
        setShowConsult(false);
      };

      return (
        <div className="min-h-screen pb-10">
          <header className="fixed top-0 inset-x-0 h-16 bg-white shadow-sm flex items-center justify-center z-50">
            <h1 className="text-xl font-black text-pink-500">星雲計畫 | 照護指南</h1>
          </header>

          <main className="max-w-md mx-auto px-4 pt-20">
            {currentPage === 'intro' && (
              <div className="text-center space-y-8 animate-in mt-10">
                <div className="bg-white p-10 rounded-[40px] shadow-xl border-b-8 border-pink-100">
                  <div className="w-20 h-20 bg-pink-50 rounded-full flex items-center justify-center mx-auto mb-6">
                    <Heart className="text-pink-400" size={40} />
                  </div>
                  <h2 className="text-2xl font-black text-gray-800 mb-2">照顧不再孤軍奮戰</h2>
                  <p className="text-gray-500 font-medium leading-relaxed">這是一份給照顧者的專屬導航<br/>協助您理清思緒，找回生活節奏</p>
                  <button onClick={() => setCurrentPage('assessment')} className="w-full mt-10 py-5 bg-pink-500 text-white rounded-full font-black text-lg shadow-lg active:scale-95 transition-all">
                    立即開始自評
                  </button>
                </div>
              </div>
            )}

            {currentPage === 'assessment' && (
              <div className="space-y-4 animate-in">
                <div className="text-center mb-6">
                  <h3 className="font-black text-gray-800 text-lg">照護三力評析</h3>
                  <p className="text-sm text-gray-400 font-bold">1 分：完全不符合 ｜ 5 分：非常符合</p>
                </div>
                {questions.map(q => (
                  <div key={q.id} className="bg-white p-5 rounded-3xl border-2 border-pink-50 shadow-sm">
                    <p className="font-bold text-gray-700 mb-4 leading-tight">{q.text}</p>
                    <div className="flex justify-between items-center">
                      {[1, 2, 3, 4, 5].map(n => (
                        <button key={n} onClick={() => setScores({...scores, [q.id]: n})} 
                          className={`w-11 h-11 rounded-full font-bold transition-all ${scores[q.id] === n ? 'bg-pink-500 text-white scale-110' : 'bg-gray-50 text-gray-400'}`}>
                          {n}
                        </button>
                      ))}
                    </div>
                  </div>
                ))}
                <button disabled={!isAssessmentComplete} onClick={() => setCurrentPage('nebula')} 
                  className="w-full py-5 bg-pink-500 text-white rounded-full font-black text-lg shadow-lg mt-6 disabled:opacity-50">
                  下一步
                </button>
              </div>
            )}

            {currentPage === 'nebula' && (
              <div className="space-y-6 animate-in">
                <div className="bg-white p-8 rounded-[32px] shadow-lg border-2 border-pink-50">
                  <h3 className="font-black text-lg mb-8 text-center text-pink-600">基本資料設定</h3>
                  <div className="space-y-6">
                    <div>
                      <label className="block text-sm font-black text-gray-400 mb-4 uppercase tracking-wider">目前壓力指數 ({nebulaData.q1})</label>
                      <input type="range" min="1" max="10" value={nebulaData.q1} onChange={e => setNebulaData({...nebulaData, q1: parseInt(e.target.value)})} className="pressure-slider" />
                    </div>
                    <select value={nebulaData.q8} onChange={e => setNebulaData({...nebulaData, q8: e.target.value})} className="w-full p-4 rounded-xl border-2 bg-gray-50 font-bold focus:border-pink-300 outline-none">
                      <option value="">主要疾病狀況</option>
                      {['失智症', '中風', '癌症', '老化衰弱', '其他'].map(d => <option key={d} value={d}>{d}</option>)}
                    </select>
                    <input type="text" placeholder="您的暱稱" value={nebulaData.nickname} onChange={e => setNebulaData({...nebulaData, nickname: e.target.value})} className="w-full p-4 rounded-xl border-2 bg-gray-50 font-bold focus:border-pink-300 outline-none" />
                    <div className="flex justify-around pt-6 border-t border-dashed">
                      {['female', 'neutral', 'male'].map(a => (
                        <button key={a} onClick={() => setNebulaData({...nebulaData, avatar: a})}><Avatar type={a} selected={nebulaData.avatar === a} /></button>
                      ))}
                    </div>
                  </div>
                </div>
                <button disabled={!nebulaData.nickname || !nebulaData.q8} onClick={() => setCurrentPage('result')} className="w-full py-5 bg-pink-500 text-white rounded-full font-black text-lg shadow-lg">
                  查看分析報告
                </button>
              </div>
            )}

            {currentPage === 'result' && (
              <div className="animate-in pb-10">
                <div id="result-card" className="bg-white p-8 rounded-[40px] shadow-2xl border-2 border-pink-50">
                  <div className="text-center mb-8">
                    <div className="inline-block p-1 rounded-full bg-pink-50 mb-4">
                      <Avatar type={nebulaData.avatar} selected={true} />
                    </div>
                    <h2 className="text-2xl font-black">{nebulaData.nickname} 的照顧指南</h2>
                    <p className="text-sm font-bold text-gray-400 mt-1">針對 {nebulaData.q8} 的照護建議</p>
                  </div>

                  <div className="space-y-6">
                    <div className="p-6 bg-pink-50 rounded-3xl border-l-8 border-pink-400">
                      <h4 className="font-black text-pink-600 mb-2 flex items-center gap-2 underline decoration-pink-200 decoration-4">核心觀察</h4>
                      <p className="text-sm text-gray-700 leading-relaxed font-medium">目前您的壓力指數為 {nebulaData.q1} 分。在面對 {nebulaData.q8} 的過程中，覺察自己的極限是最重要的第一步。這份報告顯示您具備基礎的知識力，但在支持系統的建立上仍有進步空間。</p>
                    </div>

                    <div className="p-6 bg-blue-50 rounded-3xl border-l-8 border-blue-400">
                      <h4 className="font-black text-blue-600 mb-2">專屬對策</h4>
                      <ul className="text-sm text-gray-600 space-y-3 font-medium">
                        <li className="flex items-start gap-2"><div className="w-2 h-2 rounded-full bg-blue-400 mt-1.5 shrink-0"/> 建立「具體求助清單」，讓家人知道如何分擔。</li>
                        <li className="flex items-start gap-2"><div className="w-2 h-2 rounded-full bg-blue-400 mt-1.5 shrink-0"/> 善用長照 1966 專線，媒合喘息服務。</li>
                      </ul>
                    </div>

                    <div className="bg-slate-800 p-8 rounded-[32px] text-center text-white shadow-xl no-print">
                      <Star className="mx-auto mb-4 text-yellow-400 fill-yellow-400" />
                      <p className="font-black text-lg mb-6 leading-tight">想與專家聊聊<br/>您的具體照護困境嗎？</p>
                      <button onClick={() => setShowConsult(true)} className="w-full py-4 bg-white text-slate-800 rounded-full font-black flex items-center justify-center gap-2 hover:bg-pink-50 transition-colors">
                        <MessageSquare size={18} /> 預約照顧管家諮詢
                      </button>
                    </div>
                  </div>

                  <div className="mt-10 pt-8 border-t border-gray-100 no-print flex gap-3">
                    <button onClick={handleRestart} className="flex-1 py-4 border-2 border-pink-500 text-pink-500 rounded-full font-black text-sm">重新檢測</button>
                    <button onClick={() => window.print()} className="flex-1 py-4 bg-gray-100 text-gray-700 rounded-full font-black text-sm flex items-center justify-center gap-2"><Download size={16}/> 下載 PDF</button>
                  </div>
                </div>

                {showConsult && (
                  <div className="mt-10 animate-in no-print">
                    <div className="bg-pink-50 p-4 rounded-t-[32px] text-center">
                      <p className="text-xs font-black text-pink-400">正在加載諮詢表單...</p>
                    </div>
                    <iframe src="https://www.surveycake.com/s/P8Aza" className="w-full h-[600px] rounded-b-[32px] border-4 border-pink-50 shadow-inner" />
                  </div>
                )}
              </div>
            )}
          </main>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>