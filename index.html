<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>星雲計畫 - 照護指南</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] },
          animation: { 
            'neon-pulse': 'neon-pulse 2s infinite ease-in-out',
            'in': 'fade-in 0.3s ease-out'
          },
          keyframes: { 
            'neon-pulse': { '0%, 100%': { opacity: '0.9', transform: 'scale(1)' }, '50%': { opacity: '1', transform: 'scale(1.03)' } } 
          }
        }
      }
    }
  </script>
  <style>
    .pressure-slider::-webkit-slider-thumb { -webkit-appearance: none; height: 32px; width: 32px; border-radius: 50%; background: #ec4899; border: 3px solid white; box-shadow: 0 3px 6px rgba(0,0,0,0.2); cursor: pointer; margin-top: -11px; }
    .pressure-slider::-webkit-slider-runnable-track { width: 100%; height: 10px; cursor: pointer; background: #e5e7eb; border-radius: 10px; }
    .pressure-slider:focus { outline: none; }
    select { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23d98a9d'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 1rem center; background-size: 1.5rem; }
    @media print { 
      @page { size: A4; margin: 0; } 
      body { visibility: hidden; background: white; } 
      #result-card { visibility: visible; position: absolute; left: 0; top: 0; width: 100%; margin: 0; border: none !important; box-shadow: none !important; } 
      .no-print { display: none !important; } 
    }
  </style>
  <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.0.0",
    "react-dom": "https://esm.sh/react-dom@19.0.0",
    "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.460.0",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
  <script src="https://unpkg.com/@babel/standalone@7.26.2/babel.min.js"></script>
</head>
<body class="bg-[#fffafb]">
  <div id="root"></div>
  
  <script type="text/babel" data-type="module" data-presets="typescript,react">
    import React, { useState, useEffect, useMemo } from 'react';
    import ReactDOM from 'react-dom/client';
    import { 
      Heart, Users, Calendar, ShieldCheck, BookOpen, Activity, ArrowRight, 
      ChevronDown, CheckCircle2, Lock, MessageSquare, Star, ChevronRight, 
      Share2, Download, ChevronUp, RefreshCcw, ArrowLeft, Sun 
    } from 'lucide-react';

    // --- 樣式與常數 ---
    const brandColors = {
      primary: '#ecacbc', secondary: '#a7d4e0', success: '#9bcba6',
      accent: '#f3f0b8', softBlue: '#d2e8f1', softPink: '#f4d0da', deepPink: '#d98a9d'
    };

    const questions = [
      { id: 1, text: '我能覺察自己的情緒極限，並在體力或精神透支前主動尋求喘息。', icon: <Heart size={20} /> },
      { id: 2, text: '我能讓周邊的人準確理解我的處境，避免因照顧問題產生衝突或孤立。', icon: <Users size={20} /> },
      { id: 3, text: '我能有效整合政府或民間各項資源，建立穩定的日常支援系統。', icon: <Calendar size={20} /> },
      { id: 4, text: '我對日常照顧流程有明確規劃，即使發生突發狀況也知道如何處理。', icon: <ShieldCheck size={20} /> },
      { id: 5, text: '我掌握被照顧者疾病的關鍵知識，能準確判斷其生理或行為變化的情況。', icon: <BookOpen size={20} /> },
      { id: 6, text: '在面臨醫療選擇或治療方案時，我能清楚衡量利弊並做出合適的決定。', icon: <Activity size={20} /> }
    ];

    const currentOptions = [
      { title: '體力透支', desc: '長期疲累身心已達極限', moodLabel: '沉重' },
      { title: '孤軍奮戰', desc: '獨自支撐缺乏分擔對象', moodLabel: '孤寂' },
      { title: '資訊焦慮', desc: '知識雜亂找不到正確方向', moodLabel: '迷惘' },
      { title: '決策重擔', desc: '面對重大選擇壓力極大', moodLabel: '緊繃' },
      { title: '失去生活', desc: '被照顧填滿沒了自我未來', moodLabel: '壓抑' }
    ];

    const futureOptions = [
      { title: '掌控現狀', desc: '掌控病況應對不再慌亂', moodLabel: '安穩' },
      { title: '靈活調度', desc: '善用資源建立支援系統', moodLabel: '輕盈' },
      { title: '適度喘息', desc: '定期留白休息沒有罪惡', moodLabel: '自在' },
      { title: '溝通和諧', desc: '互動順暢減少對立衝突', moodLabel: '溫慢' },
      { title: '生活平衡', desc: '照顧與工作兼顧生活不脫軌', moodLabel: '和諧' }
    ];

    // --- 圖標組件 ---
    const Avatar = ({ type, selected }) => {
      const colors = { female: '#FFEDF2', neutral: '#E0F2FE', male: '#ECFDF5' };
      const border = { female: '#F472B6', neutral: '#38BDF8', male: '#10B981' };
      return (
        <div className={`w-20 h-20 rounded-full flex items-center justify-center transition-all ${selected ? 'ring-4' : 'opacity-60'}`} 
             style={{ backgroundColor: colors[type] || '#eee', ringColor: border[type] }}>
          {type === 'female' ? <Heart size={32} color="#F472B6" /> : type === 'male' ? <Activity size={32} color="#10B981" /> : <Users size={32} color="#38BDF8" />}
        </div>
      );
    };

    // --- 主程式 ---
    const App = () => {
      const [currentPage, setCurrentPage] = useState('intro');
      const [scores, setScores] = useState({});
      const [nebulaData, setNebulaData] = useState({ q1: 5, q8: '', q9: '', q15: '', q16: '', nickname: '', avatar: 'female' });
      const [mood, setMood] = useState({ current: null, future: null });
      const [showConsult, setShowConsult] = useState(false);

      const isAssessmentComplete = useMemo(() => Object.keys(scores).length === questions.length, [scores]);

      const getRisk = (score) => {
        if (score <= 3) return { label: '高風險', color: '#ef4444', bg: '#fee2e2' };
        if (score <= 7) return { label: '中風險', color: '#f59e0b', bg: '#fef3c7' };
        return { label: '低風險', color: '#10b981', bg: '#d1fae5' };
      };

      const handleRestart = () => {
        setScores({});
        setMood({ current: null, future: null });
        setCurrentPage('intro');
      };

      return (
        <div className="min-h-screen pb-10">
          <header className="fixed top-0 inset-x-0 h-16 bg-white shadow-sm flex items-center justify-center z-50">
            <h1 className="text-xl font-black text-pink-500">星雲計畫 | 照護指南</h1>
          </header>

          <main className="max-w-md mx-auto px-4 pt-20">
            {currentPage === 'intro' && (
              <div className="text-center space-y-8 animate-in">
                <div className="bg-white p-10 rounded-[40px] shadow-xl border-b-8 border-pink-100">
                  <div className="w-20 h-20 bg-pink-50 rounded-full flex items-center justify-center mx-auto mb-6">
                    <Heart className="text-pink-400" size={40} />
                  </div>
                  <h2 className="text-2xl font-black text-gray-800 mb-2">照顧不孤單</h2>
                  <p className="text-gray-500 font-medium">給自己的安心指引，共享給家人的照顧要點</p>
                  <button onClick={() => setCurrentPage('assessment')} className="w-full mt-10 py-5 bg-pink-500 text-white rounded-full font-black text-lg shadow-lg active:scale-95 transition-all">
                    立即開始分析
                  </button>
                </div>
              </div>
            )}

            {currentPage === 'assessment' && (
              <div className="space-y-4 animate-in">
                <h3 className="text-center font-black text-gray-500 mb-4">照顧三力自評 (1-5分)</h3>
                {questions.map(q => (
                  <div key={q.id} className="bg-white p-5 rounded-3xl border-2 border-pink-50">
                    <p className="font-bold text-gray-700 mb-4 leading-tight">{q.text}</p>
                    <div className="flex justify-between">
                      {[1, 2, 3, 4, 5].map(n => (
                        <button key={n} onClick={() => setScores({...scores, [q.id]: n})} 
                          className={`w-12 h-12 rounded-full font-bold transition-all ${scores[q.id] === n ? 'bg-pink-500 text-white scale-110 shadow-md' : 'bg-gray-50 text-gray-400'}`}>
                          {n}
                        </button>
                      ))}
                    </div>
                  </div>
                ))}
                <button disabled={!isAssessmentComplete} onClick={() => setCurrentPage('nebula')} 
                  className="w-full py-5 bg-pink-500 text-white rounded-full font-black text-lg shadow-lg mt-6 disabled:opacity-50">
                  下一頁
                </button>
              </div>
            )}

            {currentPage === 'nebula' && (
              <div className="space-y-6 animate-in">
                <div className="bg-white p-6 rounded-[32px] shadow-lg border-2 border-pink-50">
                  <h3 className="font-black text-lg mb-6 text-center text-pink-600">填寫照護基礎資料</h3>
                  <div className="space-y-4">
                    <div>
                      <label className="block text-sm font-black text-gray-500 mb-2">現在壓力指數 ({nebulaData.q1})</label>
                      <input type="range" min="1" max="10" value={nebulaData.q1} onChange={e => setNebulaData({...nebulaData, q1: parseInt(e.target.value)})} className="pressure-slider w-full" />
                    </div>
                    <select value={nebulaData.q8} onChange={e => setNebulaData({...nebulaData, q8: e.target.value})} className="w-full p-4 rounded-xl border-2 bg-white font-bold outline-none">
                      <option value="">主要疾病狀況</option>
                      {['失智症', '中風', '糖尿病', '老化衰弱', '癌症'].map(d => <option key={d} value={d}>{d}</option>)}
                    </select>
                    <input type="text" placeholder="您的暱稱" value={nebulaData.nickname} onChange={e => setNebulaData({...nebulaData, nickname: e.target.value})} className="w-full p-4 rounded-xl border-2 font-bold" />
                    <div className="flex justify-around pt-4">
                      {['female', 'neutral', 'male'].map(a => (
                        <button key={a} onClick={() => setNebulaData({...nebulaData, avatar: a})}><Avatar type={a} selected={nebulaData.avatar === a} /></button>
                      ))}
                    </div>
                  </div>
                </div>
                <button disabled={!nebulaData.nickname || !nebulaData.q8} onClick={() => setCurrentPage('result')} className="w-full py-5 bg-pink-500 text-white rounded-full font-black text-lg shadow-lg">
                  生成我的照顧報告
                </button>
              </div>
            )}

            {currentPage === 'result' && (
              <div className="animate-in pb-10">
                <div id="result-card" className="bg-white p-8 rounded-[40px] shadow-2xl border-2 border-pink-50">
                  <div className="text-center mb-8">
                    <Avatar type={nebulaData.avatar} selected={true} />
                    <h2 className="text-2xl font-black mt-4">{nebulaData.nickname} 的照顧報告</h2>
                    <p className="text-sm font-bold text-gray-400">疾病：{nebulaData.q8} | 壓力：{nebulaData.q1}/10</p>
                  </div>

                  <div className="space-y-8">
                    {/* 分析卡片範例：支持力 */}
                    <div className="p-5 bg-pink-50 rounded-3xl">
                      <div className="flex justify-between items-center mb-2">
                        <h4 className="font-black text-pink-600 flex items-center gap-2"><Heart size={18}/> 支持力分析</h4>
                        <span className="px-3 py-1 rounded-full text-xs font-bold" style={{ backgroundColor: getRisk(scores[1]+scores[2]).bg, color: getRisk(scores[1]+scores[2]).color }}>{getRisk(scores[1]+scores[2]).label}</span>
                      </div>
                      <p className="text-sm text-gray-600 leading-relaxed">目前您在尋求支援與自我調節間需要更好的平衡。針對{nebulaData.q8}的長期照護，建議您建立具體的求助清單，讓身邊的人知道如何幫忙。</p>
                    </div>

                    <div className="bg-slate-50 p-6 rounded-3xl border-2 border-dashed border-slate-200 text-center">
                      <Lock className="mx-auto mb-3 text-slate-400" />
                      <p className="font-black text-slate-600 mb-4">解鎖更多個人化對策</p>
                      <button onClick={() => setShowConsult(true)} className="w-full py-4 bg-pink-500 text-white rounded-full font-black flex items-center justify-center gap-2">
                        <MessageSquare size={18} /> 預約照顧管家諮詢
                      </button>
                    </div>
                  </div>

                  <div className="mt-8 pt-8 border-t border-gray-100 no-print flex gap-3">
                    <button onClick={handleRestart} className="flex-1 py-4 border-2 border-pink-500 text-pink-500 rounded-full font-black">重新檢測</button>
                    <button onClick={() => window.print()} className="flex-1 py-4 bg-gray-800 text-white rounded-full font-black">下載 PDF</button>
                  </div>
                </div>

                {showConsult && (
                  <div className="mt-10 animate-in">
                    <iframe src="https://www.surveycake.com/s/P8Aza" className="w-full h-[600px] rounded-[32px] border-4 border-pink-50 shadow-inner" />
                  </div>
                )}
              </div>
            )}
          </main>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>